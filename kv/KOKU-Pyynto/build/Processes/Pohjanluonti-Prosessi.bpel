<?xml version='1.0' encoding='UTF-8'?>
<bpel:process xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:vprop="http://docs.oasis-open.org/wsbpel/2.0/varprop" xmlns:pnlk="http://docs.oasis-open.org/wsbpel/2.0/plnktype" xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ode="http://www.apache.org/ode/type/extension" xmlns:Pohjanluontiform1="http://www.intalio.com/gi/Forms/Pohjanluontiform.gi/attachments" xmlns:Pohjanluontiform2="http://www.intalio.com/gi/Forms/Pohjanluontiform.gi" xmlns:Pohjanluontiform="http://www.intalio.com/gi/Pohjanluontiform.gi" xmlns:Virkailija="http://arcusys.fi/Processes/Pohjanluonti/Virkailija" xmlns:diag="http://arcusys.fi/Processes/Pohjanluonti" xmlns:this="http://arcusys.fi/Processes/Pohjanluonti/Prosessi" xmlns:attachments="http://www.intalio.com/gi/Pohjanluontiform.gi/attachments" xmlns:tns="http://www.arcusys.fi/DynamicFields" xmlns:KokuRequestProcessingServiceImpl="http://soa.kv.koku.arcusys.fi/" xmlns:Palvelut="http://arcusys.fi/Processes/Pohjanluonti/Palvelut" xmlns:bpmn="http://www.intalio.com/bpms" xmlns:atomic="http://ode.apache.org/atomicScope" queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath2.0" expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath2.0" bpmn:label="Prosessi" name="Prosessi" bpmn:id="_hI25kNPKEeCtDPd7kTBk1g" targetNamespace="http://arcusys.fi/Processes/Pohjanluonti/Prosessi">
  <bpel:import namespace="http://soa.kv.koku.arcusys.fi/" location="../KokuRequestProcessingServiceImpl.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
  <bpel:import namespace="http://arcusys.fi/Processes/Pohjanluonti" location="Pohjanluonti.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
  <bpel:import namespace="http://www.intalio.com/gi/Pohjanluontiform.gi" location="../Pohjanluontiform.gi.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
  <bpel:import namespace="http://www.arcusys.fi/DynamicFields" location="../DynamicFields.xsd" importType="http://www.w3.org/2001/XMLSchema"></bpel:import>
  <bpel:partnerLinks>
    <bpel:partnerLink name="prosessiAndVirkailijaForPortTypeProcessPlkVar" partnerLinkType="diag:ProsessiAndVirkailijaForPortTypeProcessPlk" myRole="Prosessi_for_Virkailija"></bpel:partnerLink>
    <bpel:partnerLink name="palvelutAndProsessiForKokuRequestProcessingServicePortPlkVar" partnerLinkType="diag:PalvelutAndProsessiForKokuRequestProcessingServicePortPlk" initializePartnerRole="yes" partnerRole="Palvelut_for_Prosessi"></bpel:partnerLink>
  </bpel:partnerLinks>
  <bpel:variables>
    <bpel:variable name="Dynamic_Fields_Form" element="tns:Dynamic_Fields_Form"></bpel:variable>
    <bpel:variable name="pohjanluontiformInitProcessRequestMsg" messageType="Pohjanluontiform:initProcessRequest"></bpel:variable>
    <bpel:variable name="pohjanluontiformInitProcessResponseMsg" messageType="Pohjanluontiform:initProcessResponse"></bpel:variable>
    <bpel:variable name="kokuRequestProcessingServiceImplCreateRequestTemplateMsg" messageType="KokuRequestProcessingServiceImpl:createRequestTemplate"></bpel:variable>
    <bpel:variable name="kokuRequestProcessingServiceImplCreateRequestTemplateResponseMsg" messageType="KokuRequestProcessingServiceImpl:createRequestTemplateResponse"></bpel:variable>
    <bpel:variable name="kokuRequestProcessingServiceImplUpdateRequestTemplateMsg" messageType="KokuRequestProcessingServiceImpl:updateRequestTemplate"></bpel:variable>
    <bpel:variable name="kokuRequestProcessingServiceImplUpdateRequestTemplateResponseMsg" messageType="KokuRequestProcessingServiceImpl:updateRequestTemplateResponse"></bpel:variable>
  </bpel:variables>
  <bpel:sequence>
    <bpel:receive partnerLink="prosessiAndVirkailijaForPortTypeProcessPlkVar" portType="Pohjanluontiform:Process" operation="initProcess" variable="pohjanluontiformInitProcessRequestMsg" createInstance="yes" bpmn:label="Vastaanota tilaus" name="Vastaanota_tilaus" bpmn:id="_N9pMcNPLEeCtDPd7kTBk1g"></bpel:receive>
    <bpel:assign name="init-variables-Prosessi" bpmn:id="_N9pMcNPLEeCtDPd7kTBk1g">
      <bpel:copy bpmn:label="$pohjanluontiformInitProcessResponseMsg">
        <bpel:from>
          <bpel:literal>
<Pohjanluontiform:initProcessResponse>
  <Pohjanluontiform:status>OK</Pohjanluontiform:status>
  <Pohjanluontiform:errorCode></Pohjanluontiform:errorCode>
  <Pohjanluontiform:errorReason></Pohjanluontiform:errorReason>
  <Pohjanluontiform:taskMetaData>
    <Pohjanluontiform:nextTaskId></Pohjanluontiform:nextTaskId>
    <Pohjanluontiform:nextTaskURL></Pohjanluontiform:nextTaskURL>
    <Pohjanluontiform:instanceId></Pohjanluontiform:instanceId>
  </Pohjanluontiform:taskMetaData>
</Pohjanluontiform:initProcessResponse></bpel:literal>
        </bpel:from>
        <bpel:to>$pohjanluontiformInitProcessResponseMsg.root</bpel:to>
      </bpel:copy>
      <bpel:copy bpmn:label="$kokuRequestProcessingServiceImplCreateRequestTemplateMsg">
        <bpel:from>
          <bpel:literal>
<KokuRequestProcessingServiceImpl:createRequestTemplate>
  <creator></creator>
  <subject></subject>
  <questions>
    <question>
      <description></description>
      <number></number>
      <type></type>
    </question>
  </questions>
  <choices>
    <choice>
      <description></description>
      <number></number>
      <questionNumber></questionNumber>
    </choice>
  </choices>
  <visibility></visibility>
</KokuRequestProcessingServiceImpl:createRequestTemplate></bpel:literal>
        </bpel:from>
        <bpel:to>$kokuRequestProcessingServiceImplCreateRequestTemplateMsg.parameters</bpel:to>
      </bpel:copy>
      <bpel:copy bpmn:label="$kokuRequestProcessingServiceImplUpdateRequestTemplateMsg">
        <bpel:from>
          <bpel:literal>
<KokuRequestProcessingServiceImpl:updateRequestTemplate>
  <creator></creator>
  <subject></subject>
  <questions>
    <question>
      <description></description>
      <number></number>
      <type></type>
    </question>
  </questions>
  <choices>
    <choice>
      <description></description>
      <number></number>
      <questionNumber></questionNumber>
    </choice>
  </choices>
  <visibility></visibility>
</KokuRequestProcessingServiceImpl:updateRequestTemplate></bpel:literal>
        </bpel:from>
        <bpel:to>$kokuRequestProcessingServiceImplUpdateRequestTemplateMsg.parameters</bpel:to>
      </bpel:copy>
    </bpel:assign>
    <bpel:assign>
    <bpel:copy>
        <bpel:from>$ode:pid</bpel:from>
        <bpel:to>$pohjanluontiformInitProcessResponseMsg.root/Pohjanluontiform:taskMetaData/Pohjanluontiform:instanceId</bpel:to>
    </bpel:copy>
  </bpel:assign>
  <bpel:reply partnerLink="prosessiAndVirkailijaForPortTypeProcessPlkVar" portType="Pohjanluontiform:Process" operation="initProcess" variable="pohjanluontiformInitProcessResponseMsg" bpmn:label="Vastaanota tilaus" name="Vastaanota_tilaus-1" bpmn:id="_N9pMcNPLEeCtDPd7kTBk1g"></bpel:reply>
    <bpel:assign bpmn:label="Luo tilaus" name="Luo_tilaus" bpmn:id="_9mka4NPLEeCtDPd7kTBk1g">
      <bpel:copy>
        <bpel:from>$pohjanluontiformInitProcessRequestMsg.root/Pohjanluontiform:taskOutput/tns:Dynamic_Fields_Form</bpel:from>
        <bpel:to>$Dynamic_Fields_Form</bpel:to>
      </bpel:copy>
    </bpel:assign>
    <bpel:if>
      <bpel:condition>$Dynamic_Fields_Form/tns:User/tns:User_PaivitaOlemassaoleva = true()</bpel:condition>
      <bpel:sequence>
        <bpel:assign bpmn:label="Päivitä olemassaoleva pohja webservicellä" name="Päivitä_olemassaoleva_pohja_webservicellä" bpmn:id="_Vh8rQOtMEeCyA7FZBrfxSw">
          <bpel:copy>
            <bpel:from>$Dynamic_Fields_Form/tns:Header/tns:Header_Text</bpel:from>
            <bpel:to>$kokuRequestProcessingServiceImplUpdateRequestTemplateMsg.parameters/subject</bpel:to>
          </bpel:copy>
          <bpel:copy>
            <bpel:from>$Dynamic_Fields_Form/tns:User/tns:User_Sender</bpel:from>
            <bpel:to>$kokuRequestProcessingServiceImplUpdateRequestTemplateMsg.parameters/creator</bpel:to>
          </bpel:copy>
          <bpel:copy>
            <bpel:from>bpel:doXslTransform("../xsl/SendRequestQuestions.xsl", $Dynamic_Fields_Form)</bpel:from>
            <bpel:to>$kokuRequestProcessingServiceImplUpdateRequestTemplateMsg.parameters/questions</bpel:to>
          </bpel:copy>
          <bpel:copy>
            <bpel:from>bpel:doXslTransform("../xsl/SendRequestMultipleChoice.xsl", $Dynamic_Fields_Form)</bpel:from>
            <bpel:to>$kokuRequestProcessingServiceImplUpdateRequestTemplateMsg.parameters/choices</bpel:to>
          </bpel:copy>
          <bpel:copy>
            <bpel:from>$Dynamic_Fields_Form/tns:PohjaNakyvyys/tns:PohjaNakyvyys_Arvo</bpel:from>
            <bpel:to>$kokuRequestProcessingServiceImplUpdateRequestTemplateMsg.parameters/visibility</bpel:to>
          </bpel:copy>
        </bpel:assign>
        <bpel:invoke partnerLink="palvelutAndProsessiForKokuRequestProcessingServicePortPlkVar" portType="KokuRequestProcessingServiceImpl:KokuRequestProcessingService" operation="updateRequestTemplate" inputVariable="kokuRequestProcessingServiceImplUpdateRequestTemplateMsg" outputVariable="kokuRequestProcessingServiceImplUpdateRequestTemplateResponseMsg" bpmn:label="Päivitä olemassaoleva pohja webservicellä" name="Päivitä_olemassaoleva_pohja_webservicellä-1" bpmn:id="_Vh8rQOtMEeCyA7FZBrfxSw"></bpel:invoke>
      </bpel:sequence>
      <bpel:else>
        <bpel:sequence>
          <bpel:assign bpmn:label="Talleta pohja webservicellä" name="Talleta_pohja_webservicellä" bpmn:id="_HdrC4NPMEeCtDPd7kTBk1g">
            <bpel:copy>
              <bpel:from>$Dynamic_Fields_Form/tns:User/tns:User_Sender</bpel:from>
              <bpel:to>$kokuRequestProcessingServiceImplCreateRequestTemplateMsg.parameters/creator</bpel:to>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$Dynamic_Fields_Form/tns:Header/tns:Header_Text</bpel:from>
              <bpel:to>$kokuRequestProcessingServiceImplCreateRequestTemplateMsg.parameters/subject</bpel:to>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>bpel:doXslTransform("../xsl/SendRequestQuestions.xsl", $Dynamic_Fields_Form)</bpel:from>
              <bpel:to>$kokuRequestProcessingServiceImplCreateRequestTemplateMsg.parameters/questions</bpel:to>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>bpel:doXslTransform("../xsl/SendRequestMultipleChoice.xsl", $Dynamic_Fields_Form)</bpel:from>
              <bpel:to>$kokuRequestProcessingServiceImplCreateRequestTemplateMsg.parameters/choices</bpel:to>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$Dynamic_Fields_Form/tns:PohjaNakyvyys/tns:PohjaNakyvyys_Arvo</bpel:from>
              <bpel:to>$kokuRequestProcessingServiceImplCreateRequestTemplateMsg.parameters/visibility</bpel:to>
            </bpel:copy>
          </bpel:assign>
          <bpel:invoke partnerLink="palvelutAndProsessiForKokuRequestProcessingServicePortPlkVar" portType="KokuRequestProcessingServiceImpl:KokuRequestProcessingService" operation="createRequestTemplate" inputVariable="kokuRequestProcessingServiceImplCreateRequestTemplateMsg" outputVariable="kokuRequestProcessingServiceImplCreateRequestTemplateResponseMsg" bpmn:label="Talleta pohja webservicellä" name="Talleta_pohja_webservicellä-1" bpmn:id="_HdrC4NPMEeCtDPd7kTBk1g"></bpel:invoke>
        </bpel:sequence>
      </bpel:else>
    </bpel:if>
    <bpel:empty bpmn:label="Exclusive_Data-based_Gateway" name="Exclusive_Data-based_Gateway" bpmn:id="_Zci4kOtMEeCyA7FZBrfxSw">
      <bpel:links>
        <bpel:targets></bpel:targets>
      </bpel:links>
    </bpel:empty>
    <bpel:empty bpmn:label="Empty_End_Event" name="Empty_End_Event" bpmn:id="_MA59gNPMEeCtDPd7kTBk1g"></bpel:empty>
  </bpel:sequence>
</bpel:process>